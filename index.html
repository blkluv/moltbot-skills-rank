<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moltbot Skills Explorer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>
    <style>
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;  
            overflow: hidden;
        }
    </style>
</head>
<body class="bg-[#0d1117] text-gray-200 min-h-screen p-4 md:p-8 flex flex-col">
    <div class="max-w-5xl mx-auto flex-grow w-full">
        <header class="mb-10 text-center">
            <h1 class="text-4xl font-extrabold text-white mb-2 uppercase tracking-tight">Moltbot Skills</h1>
            <p class="text-gray-400">Fast search and discovery for Moltbot tools</p>
        </header>
        
        <div class="flex flex-col md:flex-row gap-4 mb-8 sticky top-4 z-10 bg-[#0d1117] py-2">
            <input type="text" id="searchInput" placeholder="Search by name or description..." 
                   class="flex-grow p-4 rounded-xl bg-[#161b22] border border-[#30363d] focus:ring-2 focus:ring-blue-500 outline-none transition-all shadow-lg">
            
            <select id="sortSelect" class="p-4 rounded-xl bg-[#161b22] border border-[#30363d] cursor-pointer outline-none focus:ring-2 focus:ring-blue-500">
                <option value="stars">Most Popular (‚≠ê)</option>
                <option value="alpha">Alphabetical (A-Z)</option>
            </select>
        </div>

        <div id="skillsList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-4 text-left">
            <div class="col-span-full text-center py-20">
                <p class="text-gray-500 animate-pulse">Initializing skills data...</p>
            </div>
        </div>
    </div>

    <footer class="mt-auto pt-10 pb-6 text-center text-gray-500 text-xs border-t border-[#30363d] w-full max-w-5xl mx-auto">
        <p>Data automatically scraped from <a href="https://clawdhub.com/skills" target="_blank" class="text-blue-400 hover:underline">ClawdHub</a>.</p>
        <p class="mt-2 uppercase tracking-widest text-[10px]">
            <span class="font-bold text-gray-400">Last Sync Status:</span> 
            <span id="syncTime" class="text-blue-500">Connecting...</span>
        </p>
    </footer>

    <script>
        let skills = [];
        const listEl = document.getElementById('skillsList');
        const syncTimeEl = document.getElementById('syncTime');

        // Main Initialization
        async function init() {
            try {
                // Fetch the JSON generated by the Python scraper
                const res = await fetch('skills.json');
                if (!res.ok) throw new Error('skills.json not found');
                
                const data = await res.json();
                
                // Set global skills list from the JSON object
                skills = data.skills || [];
                
                // Display the timestamp from the JSON
                syncTimeEl.innerText = data.last_updated || "Timestamp missing";

                if (skills.length === 0) {
                    // Debug Mode: If JSON is empty, explain why
                    listEl.innerHTML = `
                        <div class="col-span-full text-center py-20 bg-[#161b22] rounded-2xl border border-dashed border-[#30363d]">
                            <p class="text-yellow-500 text-xl font-bold mb-2">JSON is empty! üì≠</p>
                            <p class="text-gray-400 text-sm max-w-md mx-auto px-4">
                                The website was found, but the scraper didn't detect any skills. 
                                Check your GitHub Actions logs for "Found 0 skills".
                            </p>
                        </div>`;
                } else {
                    render(skills);
                }
            } catch (e) {
                console.error("App Error:", e);
                syncTimeEl.innerText = "Error Loading Data";
                listEl.innerHTML = `
                    <div class="col-span-full text-center py-20">
                        <p class="text-red-500 font-bold">Failed to load skills.json</p>
                        <p class="text-gray-500 text-sm mt-2 text-balance">
                            Make sure your GitHub Action (Update Skills Data) has finished successfully 
                            and created the skills.json file in your repository.
                        </p>
                    </div>`;
            }
        }

        // Render Cards to the Screen
        function render(data) {
            if (data.length === 0) {
                listEl.innerHTML = '<p class="col-span-full text-center text-gray-600">No results match your search.</p>';
                return;
            }

            listEl.innerHTML = data.map(s => `
                <div class="p-6 bg-[#161b22] rounded-xl border border-[#30363d] hover:border-[#58a6ff] hover:shadow-[0_0_20px_rgba(88,166,255,0.1)] transition-all group flex flex-col justify-between h-full">
                    <div>
                        <div class="flex justify-between items-start mb-3 gap-4">
                            <h3 class="text-xl font-bold text-[#58a6ff] leading-tight group-hover:text-white transition-colors">
                                ${s.name}
                            </h3>
                            <div class="bg-[#21262d] px-3 py-1 rounded-full text-sm font-bold text-yellow-500 border border-[#30363d] shadow-inner">
                                ‚≠ê ${s.stars}
                            </div>
                        </div>
                        <p class="text-gray-400 text-sm leading-relaxed mb-6 line-clamp-2">
                            ${s.desc || 'No description provided for this tool.'}
                        </p>
                    </div>
                    <div class="flex items-center justify-between border-t border-[#30363d] pt-4 mt-auto">
                        <a href="${s.url}" target="_blank" class="text-[10px] font-black text-gray-500 hover:text-white uppercase tracking-tighter flex items-center gap-1">
                            GitHub Repository <span>‚Üó</span>
                        </a>
                        <span class="text-[10px] text-gray-600 font-mono">ID: ${Math.random().toString(36).substr(2, 5)}</span>
                    </div>
                </div>
            `).join('');
        }

        // Search and Sort Logic
        function update() {
            let result = [...skills];
            const term = document.getElementById('searchInput').value;
            
            // Fuzzy search using Fuse.js
            if (term) {
                const fuse = new Fuse(skills, { 
                    keys: ['name', 'desc'], 
                    threshold: 0.3,
                    distance: 100
                });
                result = fuse.search(term).map(r => r.item);
            }

            // Sorting logic
            const sortType = document.getElementById('sortSelect').value;
            if (sortType === 'stars') {
                result.sort((a, b) => b.stars - a.stars);
            } else {
                result.sort((a, b) => a.name.localeCompare(b.name));
            }
            
            render(result);
        }

        // Event Listeners
        document.getElementById('searchInput').addEventListener('input', update);
        document.getElementById('sortSelect').addEventListener('change', update);
        
        // Boot the app
        init();
    </script>
</body>
</html>
